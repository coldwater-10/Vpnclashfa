name: Proxy Checker

on:
  schedule:
    - cron: '0 */12 * * *' # run every 12 hours

jobs:
  get_proxies:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      # Download the subscription file(s)
      - name: Download Proxy Subscriptions
        id: download_subscriptions
        run: |
          SUBSCRIPTIONS=(
            "https://proxy.yugogo.xyz/clash/proxies?type=ss,ssr,vmess,trojan,sip002" 
            "https://clash.myvm.cc/clash/proxies?type=ss,ssr,vmess,trojan,sip002"
            "https://freefq.neocities.org/free.txt" 
            "https://free.iam7.tk/clash/proxies?type=ss,ssr,vmess,trojan,sip002" 
            "https://klausvpn.posyao.com/clash/proxies?type=ss,ssr,vmess,trojan,sip002"
            "https://proxy.yiun.xyz/clash/proxies?type=ss,ssr,vmess,trojan,sip002" 
            "https://proxypool.laowang.me/clash/proxies?type=ss,ssr,vmess,trojan,sip002" 
            "https://clash.221207.xyz/pubclashyaml"
            "http://proxies.haisto.cn/clash/proxies?type=ss,ssr,vmess,trojan,sip002" 
            "https://free.jingfu.cf//clash/proxies?type=ss,ssr,vmess,trojan,sip002" 
            "https://sub.pmsub.me/clash.yaml"
            "https://raw.fastgit.org/freefq/free/master/v2"
            "https://raw.githubusercontent.com/Leon406/SubCrawler/main/sub/share/v2" 
            "https://raw.githubusercontent.com/AzadNetCH/Clash/main/V2Ray.txt"
            "https://raw.githubusercontent.com/AzadNetCH/Clash/main/AzadNet.yml"
            "https://raw.githubusercontent.com/AzadNetCH/Clash/main/AzadNet_IRAN-Direct1.yml"
            "https://raw.githubusercontent.com/AzadNetCH/Clash/main/AzadNet_IRAN-Direct2.yml"
            "https://raw.githubusercontent.com/ermaozi/get_subscribe/main/subscribe/v2ray.txt"
            "https://raw.githubusercontent.com/xiyaowong/freeFQ/main/v2ray"
            "https://raw.githubusercontent.com/iwxf/free-v2ray/master/index.html"
            "https://raw.githubusercontent.com/Jsnzkpg/Jsnzkpg/Jsnzkpg/Jsnzkpg"
            "https://raw.githubusercontent.com/wrfree/free/main/v2"
            "https://raw.githubusercontent.com/GreenFishStudio/GreenFish/master/Subscription/GreenFishYYDS"
            "https://raw.githubusercontent.com/ronghuaxueleng/get_v2/main/pub/jiang.yaml"
            "https://raw.githubusercontent.com/ermaozi/get_subscribe/main/subscribe/clash.yml"
            "https://raw.githubusercontent.com/anaer/Sub/main/clash.yaml"
            "https://raw.githubusercontent.com/aiboboxx/v2rayfree/main/v2"
            "https://raw.githubusercontent.com/moneyfly1/sublist/main/clash.yml"
            "https://raw.githubusercontent.com/kxswa/k/k/base64"
            "https://raw.githubusercontent.com/peasoft/NoMoreWalls/master/list.txt"
            "https://raw.githubusercontent.com/Rokate/Proxy-Sub/main/clash/clash_v2ray.yml"
            "https://raw.githubusercontent.com/Rokate/Proxy-Sub/main/clash/clash_ssr.yml"
            "https://raw.githubusercontent.com/Rokate/Proxy-Sub/main/clash/clash_trojan.yml"
            "https://raw.githubusercontent.com/learnhard-cn/free_proxy_ss/main/free"
            "https://raw.githubusercontent.com/learnhard-cn/free_proxy_ss/main/ss/sssub"
            "https://raw.githubusercontent.com/learnhard-cn/free_proxy_ss/main/ssr/ssrsub"
            "https://raw.githubusercontent.com/learnhard-cn/free_proxy_ss/main/v2ray/v2raysub"
            "https://raw.githubusercontent.com/ssrsub/ssr/master/Clash.yml"
            "https://raw.githubusercontent.com/ssrsub/ssr/master/V2Ray"
            "https://raw.githubusercontent.com/ssrsub/ssr/master/ss-sub"
            "https://raw.githubusercontent.com/ssrsub/ssr/master/ssrsub"
            "https://raw.githubusercontent.com/ssrsub/ssr/master/trojan"
            "https://raw.githubusercontent.com/SnapdragonLee/SystemProxy/master/dist/clash_config_extra_US.yaml"
            "https://raw.githubusercontent.com/tbbatbb/Proxy/master/dist/clash.config.yaml"
            "https://raw.fastgit.org/Pawdroid/Free-servers/main/sub"
            "https://raw.githubusercontent.com/mfuu/v2ray/master/clash.yaml"
            "https://raw.githubusercontent.com/pojiezhiyuanjun/freev2/master/0206clash.yml"
            "https://raw.githubusercontent.com/oslook/clash-freenode/main/clash.yaml"
            "https://raw.githubusercontent.com/awesome-vpn/awesome-vpn/master/all"
            "https://raw.githubusercontent.com/mianfeifq/share/main/data2023025.txt"
            "https://raw.githubusercontent.com/mahdibland/ShadowsocksAggregator/master/Eternity.txt"
            "https://raw.githubusercontent.com/mahdibland/ShadowsocksAggregator/master/Eternity"
            "https://raw.githubusercontent.com/mahdibland/ShadowsocksAggregator/master/Eternity.yml"
            "https://raw.githubusercontent.com/mahdibland/SSAggregator/master/sub/sub_merge_base64.txt"
            "https://raw.githubusercontent.com/mahdibland/SSAggregator/master/sub/sub_merge.txt"
            "https://raw.githubusercontent.com/mahdibland/SSAggregator/master/sub/sub_merge_yaml.yml"
                      )
          for SUB in "${SUBSCRIPTIONS[@]}"; do
            curl -L -o "${{ github.workspace }}/${{ hashFiles(SUB) }}.txt" "$SUB"
          done

      # Merge and filter the proxy files
      - name: Merge and Filter Proxy Files
        id: filter_proxies
        run: |
          # Concatenate all the subscription files
          cat "${{ github.workspace }}/*.txt" > "${{ github.workspace }}/all_proxies.txt"

          # Sort and filter out duplicates
          sort -u "${{ github.workspace }}/all_proxies.txt" > "${{ github.workspace }}/filtered_proxies.txt"

      # Publish filtered proxies as an artifact
      - name: Publish Filtered Proxies
        uses: actions/upload-artifact@v2
        with:
          name: filtered_proxies
          path: ${{ github.workspace }}/filtered_proxies.txt
